import{_ as T,a as F,r as y,B as b,x as B,Y as L,C as M,c as r,d as t,t as p,e as U,w as R,k as w,g as m,v as _,F as I,l as V,f as k,q as g,m as q,p as A,n as E,b as $,o as n,Z as G,$ as H,a0 as K,L as Y}from"./index-B0cCL04z.js";import{u as Z}from"./admin-DlmSrlVb.js";import"./category-B4abgVIq.js";const j={class:"main-header"},z={class:"content-area"},J={class:"form-group"},O={class:"form-group"},Q={class:"category-checkbox-group"},W=["value"],X={key:0},ee={class:"form-group"},te={class:"form-group"},oe={key:0,class:"form-group"},se={class:"existing-images"},ae=["src"],ne={class:"form-group"},re={for:"images"},ie={class:"form-actions"},le=["disabled"],de={__name:"ProductFormView",setup(ue){const{showNotification:d}=F(),u=Z(),i=y(!1),h=B(),x=$(),c=y([]),f=y([]),l=b(()=>!!h.params.id),C=b(()=>l.value?"Sửa Sản Phẩm":"Thêm Sản Phẩm Mới"),N=b(()=>l.value?"Cập Nhật":"Thêm Sản Phẩm"),o=L({id:null,name:"",description:"",price:"",categoryIds:[]});M(async()=>{if(await u.fetchCategories(),l.value){i.value=!0;try{const s=Number(h.params.id),e=await u.fetchProductById(s);o.id=e.ID,o.name=e.name,o.description=e.description,o.price=e.price,o.categoryIds=e.categories.map(v=>v.ID),f.value=e.image_urls||[]}catch(s){console.error("Failed to fetch product data:",s),d(s,"error")}finally{i.value=!1}}});const P=s=>{c.value=Array.from(s.target.files)},S=async()=>{if(!l.value&&c.value.length===0){d("Vui lòng chọn ít nhất một ảnh.","error");return}if(o.categoryIds.length===0){d("Vui lòng chọn ít nhất một danh mục.","error");return}i.value=!0;const s=new FormData;s.append("name",o.name),s.append("description",o.description),s.append("price",o.price);for(const e of o.categoryIds)s.append("category_ids",e);if(c.value.length>0)for(const e of c.value)s.append("images",e);try{if(l.value){const e=await H(h.params.id,s);u.updateProduct(e),d("Cập nhật sản phẩm thành công!")}else{const e=await K(s);u.addProduct(e),d("Thêm sản phẩm thành công!")}x.push({name:"admin-products"})}catch(e){console.error("Submit failed:",e),d(e,"error")}finally{i.value=!1}};return(s,e)=>{const v=E("RouterLink");return n(),r("div",null,[t("div",j,[t("h1",null,p(C.value),1)]),t("div",z,[i.value?(n(),U(Y,{key:0,message:"Đang tải..."})):(n(),r("form",{key:1,onSubmit:R(S,["prevent"])},[t("div",J,[e[5]||(e[5]=t("label",{for:"name"},"Tên sản phẩm",-1)),m(t("input",{type:"text",id:"name",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=a=>o.name=a),placeholder:"Nhập tên sản phẩm",required:""},null,512),[[_,o.name]])]),t("div",O,[e[9]||(e[9]=t("label",{for:"category"},"Danh mục",-1)),t("div",Q,[(n(!0),r(I,null,V(k(u).categories,a=>(n(),r("label",{key:a.ID,class:"checkbox-label"},[m(t("input",{type:"checkbox",value:a.ID,"onUpdate:modelValue":e[1]||(e[1]=D=>o.categoryIds=D)},null,8,W),[[G,o.categoryIds]]),g(" "+p(a.name),1)]))),128))]),k(u).categories.length===0?(n(),r("div",X,[t("small",null,[e[7]||(e[7]=g("Không tìm thấy danh mục nào. Vui lòng ",-1)),q(v,{to:"/admin/categories/new"},{default:A(()=>[...e[6]||(e[6]=[g("tạo danh mục",-1)])]),_:1}),e[8]||(e[8]=g(" trước.",-1))])])):w("",!0)]),t("div",ee,[e[10]||(e[10]=t("label",{for:"price"},"Giá",-1)),m(t("input",{type:"text",id:"price",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=a=>o.price=a),placeholder:"Nhập giá",required:""},null,512),[[_,o.price]])]),t("div",te,[e[11]||(e[11]=t("label",{for:"imageUrl"},"Mô tả",-1)),m(t("textarea",{id:"description",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=a=>o.description=a),placeholder:"Nhập mô tả"},null,512),[[_,o.description]])]),l.value&&f.value.length>0?(n(),r("div",oe,[e[12]||(e[12]=t("label",null,"Ảnh hiện tại",-1)),t("div",se,[(n(!0),r(I,null,V(f.value,a=>(n(),r("img",{key:a,src:a,class:"table-img"},null,8,ae))),128))])])):w("",!0),t("div",ne,[t("label",re,p(l.value?"Tải lên ảnh mới (sẽ thay thế ảnh cũ)":"Ảnh sản phẩm"),1),t("input",{type:"file",id:"images",onChange:P,multiple:"",accept:"image/*"},null,32)]),t("div",ie,[t("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=a=>k(x).back())},"Hủy"),t("button",{type:"submit",class:"btn-primary",disabled:i.value},p(i.value?"Đang xử lý...":N.value),9,le)])],32))])])}}},ge=T(de,[["__scopeId","data-v-d8a8b414"]]);export{ge as default};
