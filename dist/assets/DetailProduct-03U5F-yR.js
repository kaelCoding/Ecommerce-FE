import{_ as $,u as z,a as E,K as F,r as m,B as N,M as G,h as M,C as O,x as U,H as j,c as u,e as S,k as A,p as J,N as K,f as c,L as W,d as t,F as T,l as q,t as r,q as g,O as X,b as Y,o as n,E as Z,G as D,P as l,Q as tt}from"./index-B0cCL04z.js";import{u as et}from"./product-BSdX2pay.js";import{C as at}from"./Card-DG9Vpa1z.js";import"./category-B4abgVIq.js";const st={key:2,class:"container"},ot={class:"main-content-grid"},it={class:"image-gallery card-white"},nt={class:"main-image-wrapper"},lt=["src","alt"],rt={class:"thumbnail-list"},ct=["src","onClick"],ut={class:"info-panel card-white"},dt={class:"product-title"},pt={key:0,class:"price-info"},vt={class:"original-price"},mt={class:"product-price"},gt={key:1,class:"product-price"},ht={class:"actions"},_t={class:"quantity-selector"},ft=["value"],yt=["disabled"],kt={class:"trust-bar"},Ct={class:"trust-item"},Pt={class:"trust-item"},wt={class:"trust-item"},bt={class:"description-card card-white"},Nt={class:"description-section"},St={class:"pre-line-text"},Tt={class:"related-products-section"},Dt={class:"product-grid"},It={__name:"DetailProduct",setup(xt){const{t:h}=z(),k=U(),H=Y(),{showNotification:_}=E(),I=F(),C=et(),e=m(null),P=m([]),f=m(!0),x=N(()=>{var a,o,i;if(!e.value)return null;const s={"@context":"https://schema.org/","@type":"Product",name:e.value.name,image:((a=e.value.image_urls)==null?void 0:a[0])||"",description:e.value.description||`Mua ngay ${e.value.name} tại TuniToku Store.`,brand:{"@type":"Brand",name:((i=(o=e.value.categories)==null?void 0:o[0])==null?void 0:i.name)||"TuniToku Store"},offers:{"@type":"Offer",url:window.location.href,priceCurrency:"VND",price:L.value||e.value.price,itemCondition:"https://schema.org/NewCondition",availability:"https://schema.org/InStock"}};return JSON.stringify(s,null,2)});G(()=>{var s,a;if(e.value){const o=`${e.value.name} - TuniToku Store`,i=((s=e.value.description)==null?void 0:s.substring(0,160))||`Mua ngay ${e.value.name} chính hãng giá tốt.`,p=((a=e.value.image_urls)==null?void 0:a[0])||"",v=window.location.href;l("title",o),l("description",i),l("og:title",o,"property"),l("og:description",i,"property"),l("og:image",p,"property"),l("og:url",v,"property"),l("twitter:card","summary_large_image"),l("twitter:title",o),l("twitter:description",i),l("twitter:image",p),tt()}});const d=m(1),y=m(""),w=N(()=>{var s;return((s=M.value)==null?void 0:s.discountPercentage)||0}),L=N(()=>{var s;return e.value&&w.value>0?e.value.price*(1-w.value):(s=e.value)==null?void 0:s.price}),Q=()=>d.value++,R=()=>{d.value>1&&d.value--},B=async s=>{var a,o;if(!s){f.value=!1;return}f.value=!0;try{const i=await X(s);e.value=i,((a=e.value.image_urls)==null?void 0:a.length)>0&&(y.value=e.value.image_urls[0]);const p=(o=e.value.categories)==null?void 0:o[0];if(p){const v=p.ID;let b=C.getRelatedProducts(v,e.value.ID,6);b.length<6&&(await C.ensureCategoryProducts(v),b=C.getRelatedProducts(v,e.value.ID,6)),P.value=b}else P.value=[]}catch(i){console.error("Failed to fetch product data:",i),e.value=null,_(i,"error")}finally{f.value=!1}};O(async()=>{B(k.params.id)}),j(()=>k.params.id,s=>{s&&(window.scrollTo(0,0),B(s))});const V=async()=>{if(!M.value){_("Bạn cần đăng nhập để thêm vào giỏ hàng.","error"),H.push({path:"/login",query:{redirect:k.fullPath}});return}try{await I.addItem(e.value.ID,d.value),_("Đã thêm sản phẩm vào giỏ hàng!","success")}catch(s){_(s,"error")}};return(s,a)=>(n(),u(T,null,[x.value?(n(),S(K("script"),{key:0,type:"application/ld+json"},{default:J(()=>[g(r(x.value),1)]),_:1})):A("",!0),f.value?(n(),S(W,{key:1,message:c(h)("detailProduct.loading")},null,8,["message"])):(n(),u("div",st,[t("main",ot,[t("div",it,[t("div",nt,[t("img",{loading:"lazy",src:y.value,alt:e.value.name,class:"img-main"},null,8,lt)]),t("div",rt,[(n(!0),u(T,null,q(e.value.image_urls,o=>(n(),u("img",{loading:"lazy",key:o,src:o,class:Z({active:y.value===o}),onClick:i=>y.value=o,alt:"Thumbnail"},null,10,ct))),128))])]),t("div",ut,[t("h1",dt,r(e.value.name),1),w.value>0?(n(),u("div",pt,[t("p",vt,r(c(D)(e.value.price)),1),t("p",mt,r(c(D)(L.value)),1)])):(n(),u("p",gt,r(c(D)(e.value.price)),1)),t("div",ht,[t("div",_t,[t("button",{onClick:R,"aria-label":"Giảm số lượng"},"-"),t("input",{type:"text",value:d.value,readonly:"","aria-label":"Số lượng hiện tại"},null,8,ft),t("button",{onClick:Q,"aria-label":"Tăng số lượng"},"+")]),t("button",{class:"btn-primary",onClick:V,disabled:c(I).isLoading},[...a[0]||(a[0]=[t("i",{class:"fas fa-cart-plus"},null,-1),g(" Thêm vào giỏ ",-1)])],8,yt)]),t("div",kt,[t("div",Ct,[a[1]||(a[1]=t("i",{class:"fas fa-shield-alt"},null,-1)),a[2]||(a[2]=g()),t("span",null,r(c(h)("detailProduct.fa-shield-alt")),1)]),t("div",Pt,[a[3]||(a[3]=t("i",{class:"fas fa-truck-fast"},null,-1)),a[4]||(a[4]=g()),t("span",null,r(c(h)("detailProduct.fa-truck-fast")),1)]),t("div",wt,[a[5]||(a[5]=t("i",{class:"fas fa-box-open"},null,-1)),a[6]||(a[6]=g()),t("span",null,r(c(h)("detailProduct.fa-box-open")),1)])])])]),t("div",bt,[t("section",Nt,[a[7]||(a[7]=t("h3",null,"THÔNG TIN SẢN PHẨM",-1)),t("p",St,r(e.value.description||"Chưa có mô tả chi tiết cho sản phẩm này."),1)])]),t("section",Tt,[a[8]||(a[8]=t("h2",null,"SẢN PHẨM LIÊN QUAN",-1)),t("div",Dt,[(n(!0),u(T,null,q(P.value,o=>(n(),S(at,{key:o.ID,product:o},null,8,["product"]))),128))])])]))],64))}},Ht=$(It,[["__scopeId","data-v-5f1868fe"]]);export{Ht as default};
