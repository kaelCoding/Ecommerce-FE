import{R as i}from"./index-COQU9yFL.js";import{g as c,a as u,b as s}from"./category-C-_TWUjF.js";const h=i("product",{state:()=>({_categories:[],productsByCategory:{},categoryProductLoadState:{},isLoading:!1,error:null}),getters:{homePageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:(t.productsByCategory[e.ID]||[]).slice(0,8)})).filter(e=>e.products.length>0),listPageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:t.productsByCategory[e.ID]||[]})).filter(e=>e.products.length>0),getRelatedProducts:t=>(e,r,o=6)=>(t.productsByCategory[e]||[]).filter(a=>a.ID!==r).slice(0,o)},actions:{async _fetchCategoriesOnce(){if(!(this._categories.length>0))try{this._categories=await c(),this._categories.forEach(t=>{this.categoryProductLoadState[t.ID]||(this.categoryProductLoadState[t.ID]="none")})}catch(t){this.error=t,console.error("Failed to fetch categories:",t)}},async fetchProductsForHome(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{const r=this.categoryProductLoadState[e.ID];if(r==="limited"||r==="full")return;const o=await u(e.ID,8);this.productsByCategory[e.ID]=o||[],this.categoryProductLoadState[e.ID]="limited"});await Promise.all(t),this.isLoading=!1},async fetchProductsForList(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{if(this.categoryProductLoadState[e.ID]==="full")return;const o=await s(e.ID);this.productsByCategory[e.ID]=o||[],this.categoryProductLoadState[e.ID]="full"});await Promise.all(t),this.isLoading=!1},async ensureCategoryProducts(t){if(this.categoryProductLoadState[t]!=="full")try{const e=await s(t);this.productsByCategory[t]=e||[],this.categoryProductLoadState[t]="full"}catch(e){console.error(`Failed to fetch products for category ${t}:`,e)}}}});export{h as u};
