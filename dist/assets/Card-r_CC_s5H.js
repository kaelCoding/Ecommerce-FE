import{W as m,_ as y,B as n,p as P,a as i,e as L,m as C,d as o,c as l,t as c,n as p,k as h,E as g,g as v}from"./index-2x8Qa1C7.js";import{g as D,a as B,b as _}from"./category-CiiF-dVP.js";const V=m("product",{state:()=>({_categories:[],productsByCategory:{},categoryProductLoadState:{},isLoading:!1,error:null}),getters:{homePageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:(t.productsByCategory[e.ID]||[]).slice(0,8)})).filter(e=>e.products.length>0),listPageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:t.productsByCategory[e.ID]||[]})).filter(e=>e.products.length>0),getRelatedProducts:t=>(e,a,s=6)=>(t.productsByCategory[e]||[]).filter(r=>r.ID!==a).slice(0,s)},actions:{async _fetchCategoriesOnce(){if(!(this._categories.length>0))try{this._categories=await D(),this._categories.forEach(t=>{this.categoryProductLoadState[t.ID]||(this.categoryProductLoadState[t.ID]="none")})}catch(t){this.error=t,console.error("Failed to fetch categories:",t)}},async fetchProductsForHome(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{const a=this.categoryProductLoadState[e.ID];if(a==="limited"||a==="full")return;const s=await B(e.ID,8);this.productsByCategory[e.ID]=s||[],this.categoryProductLoadState[e.ID]="limited"});await Promise.all(t),this.isLoading=!1},async fetchProductsForList(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{if(this.categoryProductLoadState[e.ID]==="full")return;const s=await _(e.ID);this.productsByCategory[e.ID]=s||[],this.categoryProductLoadState[e.ID]="full"});await Promise.all(t),this.isLoading=!1},async ensureCategoryProducts(t){if(this.categoryProductLoadState[t]!=="full")try{const e=await _(t);this.productsByCategory[t]=e||[],this.categoryProductLoadState[t]="full"}catch(e){console.error(`Failed to fetch products for category ${t}:`,e)}}}}),S={class:"card-image-wrapper"},I=["src","alt"],w={key:0,class:"discount-badge"},k={class:"card-content"},b={class:"product-name"},x={class:"price-container"},F={key:0,class:"original-price"},E={class:"product-price"},O={__name:"Card",props:["product"],setup(t){const e=t,a=v,s=n(()=>{var r;return((r=a.value)==null?void 0:r.discountPercentage)||0}),u=n(()=>{var r;return e.product&&s.value>0?e.product.price*(1-s.value):(r=e.product)==null?void 0:r.price});return(r,d)=>{const f=P("RouterLink");return i(),L(f,{to:"/products/detail/"+t.product.ID,class:"product-card"},{default:C(()=>[o("div",S,[o("img",{src:t.product.image_urls[0],alt:t.product.name+" - Đồ chơi Tokusatsu chính hãng",loading:"lazy",class:"product-image"},null,8,I),d[0]||(d[0]=o("div",{class:"overlay"},[o("span",{class:"btn-primary"},"Xem chi tiết")],-1)),s.value>0?(i(),l("div",w," -"+c(s.value)+"% ",1)):p("",!0)]),o("div",k,[o("h3",b,c(t.product.name),1),o("div",x,[s.value>0?(i(),l("p",F,c(h(g)(t.product.price)),1)):p("",!0),o("p",E,c(h(g)(u.value)),1)])])]),_:1},8,["to"])}}},z=y(O,[["__scopeId","data-v-429964fe"]]);export{z as P,V as u};
