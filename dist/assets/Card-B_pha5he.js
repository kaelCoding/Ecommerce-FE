import{R as _,_ as f,A as g,o as u,c as n,b as o,t as i,i as d,E as l,S as m,g as y}from"./index-TAlcRXIZ.js";import{g as P,a as D,b as h}from"./category-CImB7S0T.js";const O=_("product",{state:()=>({_categories:[],productsByCategory:{},categoryProductLoadState:{},isLoading:!1,error:null}),getters:{homePageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:(t.productsByCategory[e.ID]||[]).slice(0,8)})).filter(e=>e.products.length>0),listPageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:t.productsByCategory[e.ID]||[]})).filter(e=>e.products.length>0),getRelatedProducts:t=>(e,a,r=6)=>(t.productsByCategory[e]||[]).filter(s=>s.ID!==a).slice(0,r)},actions:{async _fetchCategoriesOnce(){if(!(this._categories.length>0))try{this._categories=await P(),this._categories.forEach(t=>{this.categoryProductLoadState[t.ID]||(this.categoryProductLoadState[t.ID]="none")})}catch(t){this.error=t,console.error("Failed to fetch categories:",t)}},async fetchProductsForHome(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{const a=this.categoryProductLoadState[e.ID];if(a==="limited"||a==="full")return;const r=await D(e.ID,8);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="limited"});await Promise.all(t),this.isLoading=!1},async fetchProductsForList(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{if(this.categoryProductLoadState[e.ID]==="full")return;const r=await h(e.ID);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="full"});await Promise.all(t),this.isLoading=!1},async ensureCategoryProducts(t){if(this.categoryProductLoadState[t]!=="full")try{const e=await h(t);this.productsByCategory[t]=e||[],this.categoryProductLoadState[t]="full"}catch(e){console.error(`Failed to fetch products for category ${t}:`,e)}}}}),L={class:"card-image-wrapper"},C=["src","alt"],v={class:"card-content"},S={class:"product-name"},I={key:0,class:"price-info"},B={class:"original-price"},w={class:"discounted-price"},b={key:1,class:"product-price"},k={__name:"Card",props:["product"],setup(t){const e=t,a=y,r=g(()=>{var s;return((s=a.value)==null?void 0:s.discountPercentage)||0}),p=g(()=>{var s;return e.product&&r.value>0?e.product.price*(1-r.value):(s=e.product)==null?void 0:s.price});return(s,c)=>(u(),n("div",{class:"product-card",onClick:c[0]||(c[0]=F=>d(m)(t.product.ID))},[o("div",L,[o("img",{src:t.product.image_urls[0],alt:t.product.name,loading:"lazy",class:"product-image"},null,8,C),c[1]||(c[1]=o("div",{class:"overlay"},[o("button",{class:"btn-primary"},"Xem chi tiáº¿t")],-1))]),o("div",v,[o("h3",S,i(t.product.name),1),r.value>0?(u(),n("div",I,[o("p",B,i(d(l)(t.product.price)),1),o("p",w,i(d(l)(p.value)),1)])):(u(),n("p",b,i(d(l)(t.product.price)),1))])]))}},R=f(k,[["__scopeId","data-v-12d019bd"]]);export{R as P,O as u};
