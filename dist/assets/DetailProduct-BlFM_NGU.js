import{_ as X,u as $,r as d,A as q,B as J,N as K,c as i,d as C,b as t,F as S,j as B,t as r,i as p,p as c,h as W,k as Y,l as Z,T as tt,O as et,s as st,P as at,g as h,o,D as nt,E as m,w as F,L as H,m as R,e as P,v as U,Q as L,a as ot}from"./index-B41N1OBt.js";import{a as lt}from"./order-CvTpvCwh.js";import{u as it,P as rt}from"./Card-md0z6EGo.js";import"./category-CrKoNrPZ.js";const ut={key:1,class:"container"},dt={class:"main-content-grid"},ct={class:"image-gallery"},vt={class:"main-image-wrapper"},pt=["src","alt"],ht={class:"thumbnail-list"},mt=["src","onClick"],ft={class:"info-panel"},gt={class:"product-brand"},yt={class:"product-title"},bt={key:0,class:"price-info"},_t={class:"original-price"},kt={class:"product-price"},Ct={key:1,class:"product-price"},Pt={class:"actions"},Nt={class:"quantity-selector"},Mt=["value"],Tt={class:"extended-info-grid"},xt={class:"description-section"},Dt={class:"pre-line-text"},St={class:"related-products-section"},wt={class:"product-grid"},It={class:"checkout-modal"},Vt={class:"modal-body"},qt={key:1},Bt={class:"summary"},Ft={key:0},Ht={class:"form-group"},Rt={class:"form-group"},Ut={class:"form-group"},Lt={class:"payment-options"},Ot={class:"radio-label"},zt={class:"radio-label"},At={__name:"DetailProduct",setup(Et){const f=st(),N=ot(),{showNotification:v}=$(),M=it(),s=d(null),w=d([]),g=d(!0),T=d(!1),u=d(1),y=d(""),x=d(!1),l=d({phone:"",address:"",paymentMethod:"cod"}),b=q(()=>{var n;return((n=h.value)==null?void 0:n.discountPercentage)||0}),I=q(()=>{var n;return s.value&&b.value>0?s.value.price*(1-b.value):(n=s.value)==null?void 0:n.price}),O=()=>u.value++,z=()=>{u.value>1&&u.value--},A=()=>{x.value=!0},_=()=>{x.value=!1,E()},E=()=>{l.value={phone:"",address:"",paymentMethod:"cod"},u.value=1},Q=async()=>{T.value=!0;const n={productID:s.value.ID,quantity:u.value,customerName:h.value.username,customerPhone:l.value.phone,customerAddress:l.value.address,customerEmail:h.value.email,paymentMethod:l.value.paymentMethod};try{await lt(n),v("Đặt hàng thành công! Chúng tôi sẽ sớm liên hệ với bạn để xác nhận."),_()}catch(e){console.error("Failed to submit order:",e),v(e,"error")}finally{T.value=!1}},V=async n=>{var e;if(!n){g.value=!1;return}g.value=!0;try{const a=await at(n);s.value=a,((e=s.value.image_urls)==null?void 0:e.length)>0&&(y.value=s.value.image_urls[0]);const k=s.value.category_id;let D=M.getRelatedProducts(k,s.value.ID,6);D.length<6&&(await M.ensureCategoryProducts(k),D=M.getRelatedProducts(k,s.value.ID,6)),w.value=D}catch(a){console.error("Failed to fetch product data:",a),s.value=null,v(a,"error")}finally{g.value=!1}};J(async()=>{V(f.params.id)}),K(()=>f.params.id,n=>{n&&(window.scrollTo(0,0),V(n))});const G=()=>{h.value?A():(v("Bạn cần đăng nhập để tiến hành thanh toán.","error"),N.push({path:"/login",query:{redirect:f.fullPath}}))},j=()=>{h.value?N.push("/chat"):(v("Bạn cần đăng nhập để nhắn tin.","error"),N.push({path:"/login",query:{redirect:f.fullPath}}))};return(n,e)=>(o(),i(S,null,[g.value?(o(),C(H,{key:0,message:"Đang tải..."})):(o(),i("div",ut,[t("main",dt,[t("div",ct,[t("div",vt,[t("img",{loading:"lazy",src:y.value,alt:s.value.name,class:"img-main"},null,8,pt)]),t("div",ht,[(o(!0),i(S,null,B(s.value.image_urls,a=>(o(),i("img",{loading:"lazy",key:a,src:a,class:nt({active:y.value===a}),onClick:k=>y.value=a,alt:"Thumbnail"},null,10,mt))),128))])]),t("div",ft,[t("p",gt,r(s.value.category_name),1),t("h1",yt,r(s.value.name),1),b.value>0?(o(),i("div",bt,[t("p",_t,r(p(m)(s.value.price)),1),t("p",kt,r(p(m)(I.value)),1)])):(o(),i("p",Ct,r(p(m)(s.value.price)),1)),t("div",Pt,[t("div",Nt,[t("button",{onClick:z,"aria-label":"Giảm số lượng"},"-"),t("input",{type:"text",value:u.value,readonly:"","aria-label":"Số lượng hiện tại"},null,8,Mt),t("button",{onClick:O,"aria-label":"Tăng số lượng"},"+")]),t("button",{class:"btn-primary",onClick:G},e[4]||(e[4]=[t("i",{class:"fas fa-credit-card"},null,-1),c(" THANH TOÁN ")])),t("button",{class:"btn-primary",onClick:j},e[5]||(e[5]=[t("i",{class:"fa-solid fa-comments"},null,-1),c(" NHẮN TIN TUNI ")]))]),e[6]||(e[6]=W('<div class="trust-bar" data-v-7eb5181f><div class="trust-item" data-v-7eb5181f><i class="fas fa-shield-alt" data-v-7eb5181f></i> <span data-v-7eb5181f>Hàng chính hãng 100%</span></div><div class="trust-item" data-v-7eb5181f><i class="fas fa-truck-fast" data-v-7eb5181f></i> <span data-v-7eb5181f>Giao hàng nhanh</span></div><div class="trust-item" data-v-7eb5181f><i class="fas fa-box-open" data-v-7eb5181f></i> <span data-v-7eb5181f>Đổi trả hàng 7 ngày</span></div></div>',1))])]),t("section",Tt,[t("div",xt,[e[7]||(e[7]=t("h3",null,"Mô tả chi tiết",-1)),t("p",Dt,r(s.value.description||"Chưa có mô tả chi tiết cho sản phẩm này."),1)])]),t("section",St,[e[8]||(e[8]=t("h2",null,"Sản phẩm tương tự",-1)),e[9]||(e[9]=c()),e[10]||(e[10]=t("br",null,null,-1)),t("div",wt,[(o(!0),i(S,null,B(w.value,a=>(o(),C(rt,{key:a.ID,product:a},null,8,["product"]))),128))])])])),(o(),C(et,{to:"body"},[Y(tt,{name:"modal-fade"},{default:Z(()=>[x.value?(o(),i("div",{key:0,class:"modal-backdrop",onClick:F(_,["self"])},[t("div",It,[t("div",{class:"modal-header"},[e[12]||(e[12]=t("h3",null,"Thông tin đặt hàng",-1)),t("button",{class:"close-btn",onClick:_},e[11]||(e[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)]))]),t("div",Vt,[T.value?(o(),C(H,{key:0,message:"Đang xử lý đơn hàng..."})):(o(),i("div",qt,[t("div",Bt,[t("p",null,[e[13]||(e[13]=c("Sản phẩm: ")),t("strong",null,r(s.value.name),1)]),t("p",null,[e[14]||(e[14]=c("Số lượng: ")),t("strong",null,r(u.value),1)]),t("p",null,[e[15]||(e[15]=c("Tổng tiền: ")),t("strong",null,r(p(m)(s.value.price*u.value)),1)]),b.value>0?(o(),i("p",Ft,[e[16]||(e[16]=c("Thanh toán: ")),t("strong",null,r(p(m)(I.value*u.value)),1)])):R("",!0)]),t("form",{onSubmit:F(Q,["prevent"])},[t("div",Ht,[e[17]||(e[17]=t("label",{for:"phone"},"Số điện thoại",-1)),P(t("input",{id:"phone",type:"tel",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=a=>l.value.phone=a),placeholder:"Nhập số điện thoại của bạn",required:""},null,512),[[U,l.value.phone]])]),t("div",Rt,[e[18]||(e[18]=t("label",{for:"address"},"Địa chỉ",-1)),P(t("textarea",{id:"address",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.address=a),placeholder:"Nhập địa chỉ nhận hàng",required:""},null,512),[[U,l.value.address]])]),t("div",Ut,[e[21]||(e[21]=t("label",null,"Phương thức thanh toán",-1)),t("div",Lt,[t("div",Ot,[P(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.paymentMethod=a),value:"cod"},null,512),[[L,l.value.paymentMethod]]),e[19]||(e[19]=t("span",null,"Thanh toán khi nhận hàng",-1))]),t("div",zt,[P(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.paymentMethod=a),value:"bank_transfer"},null,512),[[L,l.value.paymentMethod]]),e[20]||(e[20]=t("span",null,"Chuyển khoản ngân hàng",-1))])])]),t("div",{class:"form-actions"},[t("button",{type:"button",class:"btn",onClick:_},"Hủy"),e[22]||(e[22]=t("button",{type:"submit",class:"btn-primary"},"Xác nhận đặt hàng",-1))])],32)]))])])])):R("",!0)]),_:1})]))],64))}},$t=X(At,[["__scopeId","data-v-7eb5181f"]]);export{$t as default};
