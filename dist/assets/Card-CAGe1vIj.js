import{R as m,_ as y,u as P,A as l,n as C,o as d,f as L,l as v,d as o,t as i,e as n,c as p,m as h,G as g,h as D}from"./index-BvrMabg1.js";import{g as I,a as S,b as _}from"./category-wZe49ORR.js";const H=m("product",{state:()=>({_categories:[],productsByCategory:{},categoryProductLoadState:{},isLoading:!1,error:null}),getters:{homePageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:(t.productsByCategory[e.ID]||[]).slice(0,8)})).filter(e=>e.products.length>0),listPageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:t.productsByCategory[e.ID]||[]})).filter(e=>e.products.length>0),getRelatedProducts:t=>(e,s,r=6)=>(t.productsByCategory[e]||[]).filter(u=>u.ID!==s).slice(0,r)},actions:{async _fetchCategoriesOnce(){if(!(this._categories.length>0))try{this._categories=await I(),this._categories.forEach(t=>{this.categoryProductLoadState[t.ID]||(this.categoryProductLoadState[t.ID]="none")})}catch(t){this.error=t,console.error("Failed to fetch categories:",t)}},async fetchProductsForHome(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{const s=this.categoryProductLoadState[e.ID];if(s==="limited"||s==="full")return;const r=await S(e.ID,8);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="limited"});await Promise.all(t),this.isLoading=!1},async fetchProductsForList(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{if(this.categoryProductLoadState[e.ID]==="full")return;const r=await _(e.ID);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="full"});await Promise.all(t),this.isLoading=!1},async ensureCategoryProducts(t){if(this.categoryProductLoadState[t]!=="full")try{const e=await _(t);this.productsByCategory[t]=e||[],this.categoryProductLoadState[t]="full"}catch(e){console.error(`Failed to fetch products for category ${t}:`,e)}}}}),w={class:"card-image-wrapper"},B=["src","alt"],k={class:"overlay"},b={class:"btn-primary"},x={key:0,class:"discount-badge"},F={class:"card-content"},R={class:"product-name"},O={class:"price-container"},E={key:0,class:"original-price"},N={class:"product-price"},V={__name:"Card",props:["product"],setup(t){const{t:e}=P(),s=t,r=D,a=l(()=>{var c;return((c=r.value)==null?void 0:c.discountPercentage)||0}),u=l(()=>{var c;return s.product&&a.value>0?s.product.price*(1-a.value):(c=s.product)==null?void 0:c.price});return(c,z)=>{const f=C("RouterLink");return d(),L(f,{to:"/products/detail/"+t.product.ID,class:"product-card"},{default:v(()=>[o("div",w,[o("img",{src:t.product.image_urls[0],alt:t.product.name+" - Đồ chơi Tokusatsu chính hãng",loading:"lazy",class:"product-image"},null,8,B),o("div",k,[o("span",b,i(n(e)("productCard.viewDetails")),1)]),a.value>0?(d(),p("div",x," -"+i(a.value)+"% ",1)):h("",!0)]),o("div",F,[o("h3",R,i(t.product.name),1),o("div",O,[a.value>0?(d(),p("p",E,i(n(g)(t.product.price)),1)):h("",!0),o("p",N,i(n(g)(u.value)),1)])])]),_:1},8,["to"])}}},T=y(V,[["__scopeId","data-v-a8a915b7"]]);export{T as P,H as u};
