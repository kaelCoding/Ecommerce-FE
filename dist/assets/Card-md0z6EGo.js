import{R as f,_ as m,A as p,o as d,c as u,b as o,t as i,m as g,i as n,E as h,S as y,g as P}from"./index-B41N1OBt.js";import{g as v,a as D,b as _}from"./category-CrKoNrPZ.js";const N=f("product",{state:()=>({_categories:[],productsByCategory:{},categoryProductLoadState:{},isLoading:!1,error:null}),getters:{homePageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:(t.productsByCategory[e.ID]||[]).slice(0,8)})).filter(e=>e.products.length>0),listPageProducts:t=>t._categories.length===0?[]:t._categories.map(e=>({...e,products:t.productsByCategory[e.ID]||[]})).filter(e=>e.products.length>0),getRelatedProducts:t=>(e,a,r=6)=>(t.productsByCategory[e]||[]).filter(s=>s.ID!==a).slice(0,r)},actions:{async _fetchCategoriesOnce(){if(!(this._categories.length>0))try{this._categories=await v(),this._categories.forEach(t=>{this.categoryProductLoadState[t.ID]||(this.categoryProductLoadState[t.ID]="none")})}catch(t){this.error=t,console.error("Failed to fetch categories:",t)}},async fetchProductsForHome(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{const a=this.categoryProductLoadState[e.ID];if(a==="limited"||a==="full")return;const r=await D(e.ID,8);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="limited"});await Promise.all(t),this.isLoading=!1},async fetchProductsForList(){this.isLoading=!0,await this._fetchCategoriesOnce();const t=this._categories.map(async e=>{if(this.categoryProductLoadState[e.ID]==="full")return;const r=await _(e.ID);this.productsByCategory[e.ID]=r||[],this.categoryProductLoadState[e.ID]="full"});await Promise.all(t),this.isLoading=!1},async ensureCategoryProducts(t){if(this.categoryProductLoadState[t]!=="full")try{const e=await _(t);this.productsByCategory[t]=e||[],this.categoryProductLoadState[t]="full"}catch(e){console.error(`Failed to fetch products for category ${t}:`,e)}}}}),C={class:"card-image-wrapper"},L=["src","alt"],S={key:0,class:"discount-badge"},I={class:"card-content"},B={class:"product-name"},b={class:"price-container"},w={key:0,class:"original-price"},k={class:"product-price"},F={__name:"Card",props:["product"],setup(t){const e=t,a=P,r=p(()=>{var s;return((s=a.value)==null?void 0:s.discountPercentage)||0}),l=p(()=>{var s;return e.product&&r.value>0?e.product.price*(1-r.value):(s=e.product)==null?void 0:s.price});return(s,c)=>(d(),u("div",{class:"product-card",onClick:c[0]||(c[0]=x=>n(y)(t.product.ID))},[o("div",C,[o("img",{src:t.product.image_urls[0],alt:t.product.name,loading:"lazy",class:"product-image"},null,8,L),c[1]||(c[1]=o("div",{class:"overlay"},[o("button",{class:"btn-primary"},"Xem chi tiáº¿t")],-1)),r.value>0?(d(),u("div",S," -"+i(r.value)+"% ",1)):g("",!0)]),o("div",I,[o("h3",B,i(t.product.name),1),o("div",b,[r.value>0?(d(),u("p",w,i(n(h)(t.product.price)),1)):g("",!0),o("p",k,i(n(h)(l.value)),1)])])]))}},R=m(F,[["__scopeId","data-v-63abcba7"]]);export{R as P,N as u};
