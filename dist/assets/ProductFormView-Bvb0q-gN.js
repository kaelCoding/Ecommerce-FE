import{_ as D,r as c,I as f,p as V,J as C,c as n,a as t,t as p,w as P,f as m,v as h,K as T,F as b,b as k,C as x,H as M,l as U,d as r,u as B}from"./index-uB2lMEmz.js";import{a as q,u as K,b as N}from"./product-CmmJF533.js";import{g as E}from"./category-DoDOBcr4.js";const H={class:"main-header"},L={class:"content-area"},R={key:0,class:"loading-indicator"},A={class:"form-group"},G={class:"form-group"},J=["value"],$={class:"form-group"},j={class:"form-group"},z={key:0,class:"form-group"},O={class:"existing-images"},Q=["src"],W={class:"form-group"},X={for:"images"},Y={key:1,class:"error-message"},Z={class:"form-action-buttons"},ee=["disabled"],te={__name:"ProductFormView",setup(ae){const g=U(),y=B(),i=c(!1),l=c(null),_=c([]),u=c([]),v=c([]),d=f(()=>!!g.params.id),w=f(()=>d.value?"Sửa Sản Phẩm":"Thêm Sản Phẩm Mới"),I=f(()=>d.value?"Cập Nhật":"Thêm Sản Phẩm");V(async()=>{try{_.value=await E()}catch(a){console.error("Failed to fetch categories:",a),l.value="Không thể tải danh sách danh mục."}if(d.value)try{i.value=!0;const a=await q(g.params.id);o.name=a.name,o.description=a.description,o.price=a.price,o.categoryId=a.category_id,o.category_name=a.category_name,v.value=a.image_urls||[]}catch(a){console.error("Failed to fetch product data:",a),l.value="Không tìm thấy sản phẩm."}finally{i.value=!1}});const o=C({name:"",description:"",price:"",categoryId:"",category_name:""}),F=a=>{u.value=Array.from(a.target.files),console.log(u.value)},S=async()=>{if(!d.value&&u.value.length===0){l.value="Please select at least one image.";return}i.value=!0,l.value=null;const a=new FormData;if(a.append("name",o.name),a.append("description",o.description),a.append("price",o.price),a.append("category_id",o.categoryId),u.value.length>0)for(const e of u.value)a.append("images",e);try{d.value?(await K(g.params.id,a),console.log("update product oke")):(await N(a),console.log("add product oke")),y.push({name:"admin-products"})}catch(e){console.error("Submit failed:",e),l.value=e.message||"Đã có lỗi xảy ra."}finally{i.value=!1}};return(a,e)=>(r(),n("div",null,[t("div",H,[t("h1",null,p(w.value),1)]),t("div",L,[i.value?(r(),n("div",R,"Đang tải...")):(r(),n("form",{key:1,onSubmit:P(S,["prevent"])},[t("div",A,[e[5]||(e[5]=t("label",{for:"name"},"Tên sản phẩm",-1)),m(t("input",{type:"text",id:"name",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=s=>o.name=s),required:""},null,512),[[h,o.name]])]),t("div",G,[e[7]||(e[7]=t("label",{for:"category"},"Danh mục",-1)),m(t("select",{id:"category",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=s=>o.categoryId=s),required:""},[e[6]||(e[6]=t("option",{value:"",disabled:""},"Chọn danh mục",-1)),(r(!0),n(b,null,k(_.value,s=>(r(),n("option",{key:s.ID,value:s.ID},p(s.name),9,J))),128))],512),[[T,o.categoryId]])]),t("div",$,[e[8]||(e[8]=t("label",{for:"price"},"Giá",-1)),m(t("input",{type:"text",id:"price",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=s=>o.price=s),required:""},null,512),[[h,o.price]])]),t("div",j,[e[9]||(e[9]=t("label",{for:"imageUrl"},"Mô tả",-1)),m(t("textarea",{id:"description",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>o.description=s)},null,512),[[h,o.description]])]),d.value&&v.value.length>0?(r(),n("div",z,[e[10]||(e[10]=t("label",null,"Ảnh hiện tại",-1)),t("div",O,[(r(!0),n(b,null,k(v.value,s=>(r(),n("img",{key:s,src:s,class:"table-img"},null,8,Q))),128))])])):x("",!0),t("div",W,[t("label",X,p(d.value?"Tải lên ảnh mới (sẽ thay thế ảnh cũ)":"Ảnh sản phẩm"),1),t("input",{type:"file",id:"images",onChange:F,multiple:"",accept:"image/*"},null,32)]),l.value?(r(),n("div",Y,p(l.value),1)):x("",!0),t("div",Z,[t("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=s=>M(y).back()),style:{"background-color":"#6B7280",color:"white"}},"Hủy"),t("button",{type:"submit",class:"btn btn-primary",disabled:i.value},p(i.value?"Đang xử lý...":I.value),9,ee)])],32))])]))}},re=D(te,[["__scopeId","data-v-b6d42b3c"]]);export{re as default};
