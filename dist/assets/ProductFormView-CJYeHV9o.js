import{_ as F,u as V,r as c,Q as f,y as C,C as D,R as N,c as l,a as t,t as p,b as T,w as P,d as m,v as h,S as U,F as b,g as w,j as M,A as B,p as L,o as n,m as q,U as R,V as A,L as E}from"./index-2CdpPLmO.js";import{g as j}from"./category-CUGJxbzB.js";const G={class:"main-header"},H={class:"content-area"},Q={class:"form-group"},$={class:"form-group"},z=["value"],J={class:"form-group"},K={class:"form-group"},O={key:0,class:"form-group"},W={class:"existing-images"},X=["src"],Y={class:"form-group"},Z={for:"images"},ee={class:"form-actions"},te=["disabled"],ae={__name:"ProductFormView",setup(oe){const{showNotification:d}=V(),g=L(),y=q(),r=c(!1),_=c([]),u=c([]),v=c([]),i=f(()=>!!g.params.id),x=f(()=>i.value?"Sửa Sản Phẩm":"Thêm Sản Phẩm Mới"),S=f(()=>i.value?"Cập Nhật":"Thêm Sản Phẩm");C(async()=>{try{_.value=await j()}catch(a){console.error("Failed to fetch categories:",a),d(a,"error")}if(i.value)try{r.value=!0;const a=await D(g.params.id);o.name=a.name,o.description=a.description,o.price=a.price,o.categoryId=a.category_id,o.category_name=a.category_name,v.value=a.image_urls||[]}catch(a){console.error("Failed to fetch product data:",a),d(a,"error")}finally{r.value=!1}});const o=N({name:"",description:"",price:"",categoryId:"",category_name:""}),k=a=>{u.value=Array.from(a.target.files),console.log(u.value)},I=async()=>{if(!i.value&&u.value.length===0){d("Please select at least one image.","error");return}r.value=!0;const a=new FormData;if(a.append("name",o.name),a.append("description",o.description),a.append("price",o.price),a.append("category_id",o.categoryId),u.value.length>0)for(const e of u.value)a.append("images",e);try{i.value?(await R(g.params.id,a),d("Cập nhật sản phẩm thành công!")):(await A(a),d("Thêm sản phẩm thành công!")),y.push({name:"admin-products"})}catch(e){console.error("Submit failed:",e),d(e,"error")}finally{r.value=!1}};return(a,e)=>(n(),l("div",null,[t("div",G,[t("h1",null,p(x.value),1)]),t("div",H,[r.value?(n(),T(E,{key:0,message:"Đang tải..."})):(n(),l("form",{key:1,onSubmit:P(I,["prevent"])},[t("div",Q,[e[5]||(e[5]=t("label",{for:"name"},"Tên sản phẩm",-1)),m(t("input",{type:"text",id:"name",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=s=>o.name=s),placeholder:"Nhập tên sản phẩm",required:""},null,512),[[h,o.name]])]),t("div",$,[e[7]||(e[7]=t("label",{for:"category"},"Danh mục",-1)),m(t("select",{id:"category",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=s=>o.categoryId=s),required:""},[e[6]||(e[6]=t("option",{value:"",disabled:""},"Chọn danh mục",-1)),(n(!0),l(b,null,w(_.value,s=>(n(),l("option",{key:s.ID,value:s.ID},p(s.name),9,z))),128))],512),[[U,o.categoryId]])]),t("div",J,[e[8]||(e[8]=t("label",{for:"price"},"Giá",-1)),m(t("input",{type:"text",id:"price",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=s=>o.price=s),placeholder:"Nhập giá",required:""},null,512),[[h,o.price]])]),t("div",K,[e[9]||(e[9]=t("label",{for:"imageUrl"},"Mô tả",-1)),m(t("textarea",{id:"description",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>o.description=s),placeholder:"Nhập mô tả"},null,512),[[h,o.description]])]),i.value&&v.value.length>0?(n(),l("div",O,[e[10]||(e[10]=t("label",null,"Ảnh hiện tại",-1)),t("div",W,[(n(!0),l(b,null,w(v.value,s=>(n(),l("img",{key:s,src:s,class:"table-img"},null,8,X))),128))])])):M("",!0),t("div",Y,[t("label",Z,p(i.value?"Tải lên ảnh mới (sẽ thay thế ảnh cũ)":"Ảnh sản phẩm"),1),t("input",{type:"file",id:"images",onChange:k,multiple:"",accept:"image/*"},null,32)]),t("div",ee,[t("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=s=>B(y).back())},"Hủy"),t("button",{type:"submit",class:"btn-primary",disabled:r.value},p(r.value?"Đang xử lý...":S.value),9,te)])],32))])]))}},re=F(ae,[["__scopeId","data-v-51ebeec9"]]);export{re as default};
