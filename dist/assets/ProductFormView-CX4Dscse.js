import{_ as N,u as V,r as h,O as v,A as C,P as D,c as l,a as t,t as p,b as F,w as T,d as m,v as y,Q as B,F as b,h as S,g as w,k as M,q as U,o as n,n as q,R as L,S as A,L as R}from"./index-DQuDyKue.js";import{u as E}from"./admin-CYxKsELy.js";import"./category-BI0ApnDw.js";const G={class:"main-header"},H={class:"content-area"},O={class:"form-group"},Q={class:"form-group"},$=["value"],j={class:"form-group"},z={class:"form-group"},J={key:0,class:"form-group"},K={class:"existing-images"},W=["src"],X={class:"form-group"},Y={for:"images"},Z={class:"form-actions"},ee=["disabled"],te={__name:"ProductFormView",setup(ae){const{showNotification:d}=V(),u=E(),i=h(!1),f=U(),_=q(),c=h([]),g=h([]),r=v(()=>!!f.params.id),I=v(()=>r.value?"Sửa Sản Phẩm":"Thêm Sản Phẩm Mới"),P=v(()=>r.value?"Cập Nhật":"Thêm Sản Phẩm");C(async()=>{if(await u.fetchCategories(),r.value){i.value=!0;try{const o=Number(f.params.id),e=await u.fetchProductById(o);a.id=e.ID,a.name=e.name,a.description=e.description,a.price=e.price,a.categoryId=e.category_id,g.value=e.image_urls||[]}catch(o){console.error("Failed to fetch product data:",o),d(o,"error")}finally{i.value=!1}}});const a=D({id:null,name:"",description:"",price:"",categoryId:""}),k=o=>{c.value=Array.from(o.target.files)},x=async()=>{if(!r.value&&c.value.length===0){d("Vui lòng chọn ít nhất một ảnh.","error");return}i.value=!0;const o=new FormData;if(o.append("name",a.name),o.append("description",a.description),o.append("price",a.price),o.append("category_id",a.categoryId),c.value.length>0)for(const e of c.value)o.append("images",e);try{if(r.value){const e=await L(f.params.id,o);u.updateProduct(e),d("Cập nhật sản phẩm thành công!")}else{const e=await A(o);u.addProduct(e),d("Thêm sản phẩm thành công!")}_.push({name:"admin-products"})}catch(e){console.error("Submit failed:",e),d(e,"error")}finally{i.value=!1}};return(o,e)=>(n(),l("div",null,[t("div",G,[t("h1",null,p(I.value),1)]),t("div",H,[i.value?(n(),F(R,{key:0,message:"Đang tải..."})):(n(),l("form",{key:1,onSubmit:T(x,["prevent"])},[t("div",O,[e[5]||(e[5]=t("label",{for:"name"},"Tên sản phẩm",-1)),m(t("input",{type:"text",id:"name",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=s=>a.name=s),placeholder:"Nhập tên sản phẩm",required:""},null,512),[[y,a.name]])]),t("div",Q,[e[7]||(e[7]=t("label",{for:"category"},"Danh mục",-1)),m(t("select",{id:"category",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=s=>a.categoryId=s),required:""},[e[6]||(e[6]=t("option",{value:"",disabled:""},"Chọn danh mục",-1)),(n(!0),l(b,null,S(w(u).categories,s=>(n(),l("option",{key:s.ID,value:s.ID},p(s.name),9,$))),128))],512),[[B,a.categoryId]])]),t("div",j,[e[8]||(e[8]=t("label",{for:"price"},"Giá",-1)),m(t("input",{type:"text",id:"price",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=s=>a.price=s),placeholder:"Nhập giá",required:""},null,512),[[y,a.price]])]),t("div",z,[e[9]||(e[9]=t("label",{for:"imageUrl"},"Mô tả",-1)),m(t("textarea",{id:"description",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>a.description=s),placeholder:"Nhập mô tả"},null,512),[[y,a.description]])]),r.value&&g.value.length>0?(n(),l("div",J,[e[10]||(e[10]=t("label",null,"Ảnh hiện tại",-1)),t("div",K,[(n(!0),l(b,null,S(g.value,s=>(n(),l("img",{key:s,src:s,class:"table-img"},null,8,W))),128))])])):M("",!0),t("div",X,[t("label",Y,p(r.value?"Tải lên ảnh mới (sẽ thay thế ảnh cũ)":"Ảnh sản phẩm"),1),t("input",{type:"file",id:"images",onChange:k,multiple:"",accept:"image/*"},null,32)]),t("div",Z,[t("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=s=>w(_).back())},"Hủy"),t("button",{type:"submit",class:"btn-primary",disabled:i.value},p(i.value?"Đang xử lý...":P.value),9,ee)])],32))])]))}},ie=N(te,[["__scopeId","data-v-39e01cff"]]);export{ie as default};
