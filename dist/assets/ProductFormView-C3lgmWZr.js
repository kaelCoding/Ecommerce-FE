import{_ as F,m as D,r as c,O as v,k as P,B as T,P as V,c as l,a as t,t as p,b as C,w as B,f as m,v as h,Q as M,F as b,d as x,G as U,p as N,h as L,e as n,u as q,R,S as E,L as G}from"./index-B4XQbLVi.js";import{g as K}from"./category-DggWTtiu.js";const A={class:"main-header"},H={class:"content-area"},O={class:"form-group"},Q={class:"form-group"},$=["value"],j={class:"form-group"},z={class:"form-group"},J={key:0,class:"form-group"},W={class:"existing-images"},X=["src"],Y={class:"form-group"},Z={for:"images"},ee={class:"form-action-buttons"},te=["disabled"],ae={__name:"ProductFormView",setup(oe){const{showNotification:d}=D(),g=L(),y=q(),r=c(!1),_=c([]),u=c([]),f=c([]),i=v(()=>!!g.params.id),k=v(()=>i.value?"Sửa Sản Phẩm":"Thêm Sản Phẩm Mới"),w=v(()=>i.value?"Cập Nhật":"Thêm Sản Phẩm");P(async()=>{try{_.value=await K()}catch(a){console.error("Failed to fetch categories:",a),d("Không thể tải danh sách danh mục.","error")}if(i.value)try{r.value=!0;const a=await T(g.params.id);o.name=a.name,o.description=a.description,o.price=a.price,o.categoryId=a.category_id,o.category_name=a.category_name,f.value=a.image_urls||[]}catch(a){console.error("Failed to fetch product data:",a),d("Không tìm thấy sản phẩm.","error")}finally{r.value=!1}});const o=V({name:"",description:"",price:"",categoryId:"",category_name:""}),S=a=>{u.value=Array.from(a.target.files),console.log(u.value)},I=async()=>{if(!i.value&&u.value.length===0){d("Please select at least one image.","error");return}r.value=!0;const a=new FormData;if(a.append("name",o.name),a.append("description",o.description),a.append("price",o.price),a.append("category_id",o.categoryId),u.value.length>0)for(const e of u.value)a.append("images",e);try{i.value?(await R(g.params.id,a),d("Cập nhật sản phẩm thành công!")):(await E(a),d("Thêm sản phẩm thành công!")),y.push({name:"admin-products"})}catch(e){console.error("Submit failed:",e),d("Đã có lỗi xảy ra.","error")}finally{r.value=!1}};return(a,e)=>(n(),l("div",null,[t("div",A,[t("h1",null,p(k.value),1)]),t("div",H,[r.value?(n(),C(G,{key:0,message:"Đang tải..."})):(n(),l("form",{key:1,onSubmit:B(I,["prevent"])},[t("div",O,[e[5]||(e[5]=t("label",{for:"name"},"Tên sản phẩm",-1)),m(t("input",{type:"text",id:"name",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=s=>o.name=s),required:""},null,512),[[h,o.name]])]),t("div",Q,[e[7]||(e[7]=t("label",{for:"category"},"Danh mục",-1)),m(t("select",{id:"category",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=s=>o.categoryId=s),required:""},[e[6]||(e[6]=t("option",{value:"",disabled:""},"Chọn danh mục",-1)),(n(!0),l(b,null,x(_.value,s=>(n(),l("option",{key:s.ID,value:s.ID},p(s.name),9,$))),128))],512),[[M,o.categoryId]])]),t("div",j,[e[8]||(e[8]=t("label",{for:"price"},"Giá",-1)),m(t("input",{type:"text",id:"price",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=s=>o.price=s),required:""},null,512),[[h,o.price]])]),t("div",z,[e[9]||(e[9]=t("label",{for:"imageUrl"},"Mô tả",-1)),m(t("textarea",{id:"description",class:"form-input","onUpdate:modelValue":e[3]||(e[3]=s=>o.description=s)},null,512),[[h,o.description]])]),i.value&&f.value.length>0?(n(),l("div",J,[e[10]||(e[10]=t("label",null,"Ảnh hiện tại",-1)),t("div",W,[(n(!0),l(b,null,x(f.value,s=>(n(),l("img",{key:s,src:s,class:"table-img"},null,8,X))),128))])])):U("",!0),t("div",Y,[t("label",Z,p(i.value?"Tải lên ảnh mới (sẽ thay thế ảnh cũ)":"Ảnh sản phẩm"),1),t("input",{type:"file",id:"images",onChange:S,multiple:"",accept:"image/*"},null,32)]),t("div",ee,[t("button",{type:"button",class:"btn",onClick:e[4]||(e[4]=s=>N(y).back())},"Hủy"),t("button",{type:"submit",class:"btn-primary",disabled:r.value},p(r.value?"Đang xử lý...":w.value),9,te)])],32))])]))}},re=F(ae,[["__scopeId","data-v-ae32ca00"]]);export{re as default};
