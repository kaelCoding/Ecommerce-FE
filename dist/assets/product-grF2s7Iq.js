import{A as a}from"./index-Cmxnodc5.js";import{g as o,a as c,b as l}from"./category-CMg7OFEH.js";const d=720*60*1e3,m=a("product",{state:()=>({categoriesWithProducts:[],isLoading:!1,error:null,allProductsLoaded:!1}),actions:{startLimitedProductsTimer(){this.stopLimitedProductsTimer(),this.limitedProductsTimer=setInterval(()=>{this.fetchLimitedProductsForCategories()},d)},stopLimitedProductsTimer(){this.limitedProductsTimer&&(clearInterval(this.limitedProductsTimer),this.limitedProductsTimer=null)},startAllProductsTimer(){this.stopAllProductsTimer(),this.allProductsTimer=setInterval(()=>{this.fetchCategoriesAndProducts()},d)},stopAllProductsTimer(){this.allProductsTimer&&(clearInterval(this.allProductsTimer),this.allProductsTimer=null)},async fetchLimitedProductsForCategories(){if(this.categoriesWithProducts.length>0&&!this.isLoading&&!this.limitedProductsTimer){this.startLimitedProductsTimer();return}this.isLoading=!0,this.error=null;try{const t=await o();if(!t||t.length===0){this.categoriesWithProducts=[];return}const s=t.map(r=>c(r.ID).then(e=>({...r,products:e}))),i=await Promise.all(s);this.categoriesWithProducts=i.filter(r=>r.products&&r.products.length>0),this.startLimitedProductsTimer()}catch(t){throw this.error=t,console.error("Failed to fetch limited data:",t),t}finally{this.isLoading=!1}},async fetchCategoriesAndProducts(){if(this.allProductsLoaded&&!this.allProductsTimer){this.startAllProductsTimer();return}this.isLoading=!0,this.error=null;try{const t=await o();if(!t||t.length===0){this.categoriesWithProducts=[],this.allProductsLoaded=!0;return}const s=t.map(r=>l(r.ID).then(e=>({...r,products:e}))),i=await Promise.all(s);this.categoriesWithProducts=i.filter(r=>r.products&&r.products.length>0),this.allProductsLoaded=!0,this.startAllProductsTimer()}catch(t){throw this.error=t,console.error("Failed to fetch data:",t),t}finally{this.isLoading=!1}},resetProductState(){this.stopLimitedProductsTimer(),this.stopAllProductsTimer(),this.categoriesWithProducts=[],this.allProductsLoaded=!1,this.isLoading=!1,this.error=null}}});export{m as u};
