import{_ as W,u as Y,r as d,B as V,o as Z,N as tt,O as et,c as r,e as g,m as O,P as at,n as q,d as t,F as B,l as R,t as i,k as f,q as c,i as st,j as nt,T as ot,Q as lt,x as it,R as rt,g as y,a as o,D as ut,E as _,w as F,L as H,f as w,v as E,S as j,b as dt,U as p,V as ct}from"./index-2x8Qa1C7.js";import{a as pt}from"./order-Cp5au3rG.js";import{u as vt,P as mt}from"./Card-r_CC_s5H.js";import"./category-CiiF-dVP.js";const ht={key:2,class:"container"},gt={class:"main-content-grid"},ft={class:"image-gallery"},yt={class:"main-image-wrapper"},_t=["src","alt"],kt={class:"thumbnail-list"},bt=["src","onClick"],Ct={class:"info-panel"},Tt={class:"product-brand"},Nt={class:"product-title"},wt={key:0,class:"price-info"},Pt={class:"original-price"},Mt={class:"product-price"},St={key:1,class:"product-price"},xt={class:"actions"},Dt={class:"quantity-selector"},It=["value"],Vt={class:"extended-info-grid"},qt={class:"description-section"},Bt={class:"pre-line-text"},$t={class:"related-products-section"},Ut={class:"product-grid"},Lt={class:"checkout-modal"},Ot={class:"modal-body"},Rt={key:1},Ft={class:"summary"},Ht={key:0},Et={class:"form-group"},jt={class:"form-group"},zt={class:"form-group"},Qt={class:"payment-options"},At={class:"radio-label"},Gt={class:"radio-label"},Jt={__name:"DetailProduct",setup(Xt){const k=it(),P=dt(),{showNotification:h}=Y(),M=vt(),a=d(null),$=d([]),b=d(!0),S=d(!1),u=d(1),C=d(""),x=d(!1),l=d({phone:"",address:"",paymentMethod:"cod"}),T=V(()=>{var n;return((n=y.value)==null?void 0:n.discountPercentage)||0}),D=V(()=>{var n;return a.value&&T.value>0?a.value.price*(1-T.value):(n=a.value)==null?void 0:n.price}),z=()=>u.value++,Q=()=>{u.value>1&&u.value--},A=()=>{x.value=!0},N=()=>{x.value=!1,G()},G=()=>{l.value={phone:"",address:"",paymentMethod:"cod"},u.value=1},J=async()=>{S.value=!0;const n={productID:a.value.ID,quantity:u.value,customerName:y.value.username,customerPhone:l.value.phone,customerAddress:l.value.address,customerEmail:y.value.email,paymentMethod:l.value.paymentMethod};try{await pt(n),h("Đặt hàng thành công! Chúng tôi sẽ sớm liên hệ với bạn để xác nhận."),N()}catch(e){console.error("Failed to submit order:",e),h(e,"error")}finally{S.value=!1}},U=async n=>{var e;if(!n){b.value=!1;return}b.value=!0;try{const s=await rt(n);a.value=s,((e=a.value.image_urls)==null?void 0:e.length)>0&&(C.value=a.value.image_urls[0]);const v=a.value.category_id;let m=M.getRelatedProducts(v,a.value.ID,6);m.length<6&&(await M.ensureCategoryProducts(v),m=M.getRelatedProducts(v,a.value.ID,6)),$.value=m}catch(s){console.error("Failed to fetch product data:",s),a.value=null,h(s,"error")}finally{b.value=!1}};Z(async()=>{U(k.params.id)}),tt(()=>k.params.id,n=>{n&&(window.scrollTo(0,0),U(n))});const X=()=>{y.value?A():(h("Bạn cần đăng nhập để tiến hành thanh toán.","error"),P.push({path:"/login",query:{redirect:k.fullPath}}))},K=()=>{y.value?P.push("/chat"):(h("Bạn cần đăng nhập để nhắn tin.","error"),P.push({path:"/login",query:{redirect:k.fullPath}}))},L=V(()=>{if(!a.value)return null;const n={"@context":"https://schema.org/","@type":"Product",name:a.value.name,image:a.value.image_urls[0],description:a.value.description||`Mua ngay ${a.value.name} chính hãng tại Tuni Toku. Sản phẩm thuộc series ${a.value.category_name}. Cam kết chất lượng, giao hàng toàn quốc.`,brand:{"@type":"Brand",name:"Bandai"},sku:`TUNI-${a.value.ID}`,offers:{"@type":"Offer",url:window.location.href,priceCurrency:"VND",price:D.value,availability:"https://schema.org/InStock",itemCondition:"https://schema.org/NewCondition"}};return JSON.stringify(n)});return et(()=>{if(a.value&&a.value.name){const n="Tuni Toku",e=a.value.name,s=a.value.category_name,v=a.value.image_urls[0],m=`${e} | ${s} | ${n}`,I=`Mua ngay ${e} chính hãng tại Tuni Toku. Sản phẩm thuộc series ${s}. Cam kết chất lượng, giao hàng toàn quốc.`;document.title=m,p("description",I,!1),p("og:title",m),p("og:description",I),p("og:url",window.location.href),p("og:image",v),p("twitter:title",m,!1),p("twitter:description",I,!1),p("twitter:image",v,!1),ct()}}),(n,e)=>(o(),r(B,null,[L.value?(o(),g(at("script"),{key:0,type:"application/ld+json"},{default:O(()=>[c(i(L.value),1)]),_:1})):q("",!0),b.value?(o(),g(H,{key:1,message:"Đang tải..."})):(o(),r("div",ht,[t("main",gt,[t("div",ft,[t("div",yt,[t("img",{loading:"lazy",src:C.value,alt:a.value.name,class:"img-main"},null,8,_t)]),t("div",kt,[(o(!0),r(B,null,R(a.value.image_urls,s=>(o(),r("img",{loading:"lazy",key:s,src:s,class:ut({active:C.value===s}),onClick:v=>C.value=s,alt:"Thumbnail"},null,10,bt))),128))])]),t("div",Ct,[t("p",Tt,i(a.value.category_name),1),t("h1",Nt,i(a.value.name),1),T.value>0?(o(),r("div",wt,[t("p",Pt,i(f(_)(a.value.price)),1),t("p",Mt,i(f(_)(D.value)),1)])):(o(),r("p",St,i(f(_)(a.value.price)),1)),t("div",xt,[t("div",Dt,[t("button",{onClick:Q,"aria-label":"Giảm số lượng"},"-"),t("input",{type:"text",value:u.value,readonly:"","aria-label":"Số lượng hiện tại"},null,8,It),t("button",{onClick:z,"aria-label":"Tăng số lượng"},"+")]),t("button",{class:"btn-primary",onClick:X},e[4]||(e[4]=[t("i",{class:"fas fa-credit-card"},null,-1),c(" THANH TOÁN ")])),t("button",{class:"btn-primary",onClick:K},e[5]||(e[5]=[t("i",{class:"fa-solid fa-comments"},null,-1),c(" NHẮN TIN TUNI ")]))]),e[6]||(e[6]=st('<div class="trust-bar" data-v-d6a96ce2><div class="trust-item" data-v-d6a96ce2><i class="fas fa-shield-alt" data-v-d6a96ce2></i> <span data-v-d6a96ce2>Hàng chính hãng 100%</span></div><div class="trust-item" data-v-d6a96ce2><i class="fas fa-truck-fast" data-v-d6a96ce2></i> <span data-v-d6a96ce2>Giao hàng nhanh</span></div><div class="trust-item" data-v-d6a96ce2><i class="fas fa-box-open" data-v-d6a96ce2></i> <span data-v-d6a96ce2>Đổi trả hàng 7 ngày</span></div></div>',1))])]),t("section",Vt,[t("div",qt,[e[7]||(e[7]=t("h3",null,"Mô tả chi tiết",-1)),t("p",Bt,i(a.value.description||"Chưa có mô tả chi tiết cho sản phẩm này."),1)])]),t("section",$t,[e[8]||(e[8]=t("h2",null,"Sản phẩm tương tự",-1)),e[9]||(e[9]=c()),e[10]||(e[10]=t("br",null,null,-1)),t("div",Ut,[(o(!0),r(B,null,R($.value,s=>(o(),g(mt,{key:s.ID,product:s},null,8,["product"]))),128))])])])),(o(),g(lt,{to:"body"},[nt(ot,{name:"modal-fade"},{default:O(()=>[x.value?(o(),r("div",{key:0,class:"modal-backdrop",onClick:F(N,["self"])},[t("div",Lt,[t("div",{class:"modal-header"},[e[12]||(e[12]=t("h3",null,"Thông tin đặt hàng",-1)),t("button",{class:"close-btn",onClick:N},e[11]||(e[11]=[t("i",{class:"fa-solid fa-xmark"},null,-1)]))]),t("div",Ot,[S.value?(o(),g(H,{key:0,message:"Đang xử lý đơn hàng..."})):(o(),r("div",Rt,[t("div",Ft,[t("p",null,[e[13]||(e[13]=c("Sản phẩm: ")),t("strong",null,i(a.value.name),1)]),t("p",null,[e[14]||(e[14]=c("Số lượng: ")),t("strong",null,i(u.value),1)]),t("p",null,[e[15]||(e[15]=c("Tổng tiền: ")),t("strong",null,i(f(_)(a.value.price*u.value)),1)]),T.value>0?(o(),r("p",Ht,[e[16]||(e[16]=c("Thanh toán: ")),t("strong",null,i(f(_)(D.value*u.value)),1)])):q("",!0)]),t("form",{onSubmit:F(J,["prevent"])},[t("div",Et,[e[17]||(e[17]=t("label",{for:"phone"},"Số điện thoại",-1)),w(t("input",{id:"phone",type:"tel",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=s=>l.value.phone=s),placeholder:"Nhập số điện thoại của bạn",required:""},null,512),[[E,l.value.phone]])]),t("div",jt,[e[18]||(e[18]=t("label",{for:"address"},"Địa chỉ",-1)),w(t("textarea",{id:"address",class:"form-input","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.address=s),placeholder:"Nhập địa chỉ nhận hàng",required:""},null,512),[[E,l.value.address]])]),t("div",zt,[e[21]||(e[21]=t("label",null,"Phương thức thanh toán",-1)),t("div",Qt,[t("div",At,[w(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.paymentMethod=s),value:"cod"},null,512),[[j,l.value.paymentMethod]]),e[19]||(e[19]=t("span",null,"Thanh toán khi nhận hàng",-1))]),t("div",Gt,[w(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.paymentMethod=s),value:"bank_transfer"},null,512),[[j,l.value.paymentMethod]]),e[20]||(e[20]=t("span",null,"Chuyển khoản ngân hàng",-1))])])]),t("div",{class:"form-actions"},[t("button",{type:"button",class:"btn",onClick:N},"Hủy"),e[22]||(e[22]=t("button",{type:"submit",class:"btn-primary"},"Xác nhận đặt hàng",-1))])],32)]))])])])):q("",!0)]),_:1})]))],64))}},te=W(Jt,[["__scopeId","data-v-d6a96ce2"]]);export{te as default};
