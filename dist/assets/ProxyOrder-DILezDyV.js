import{T as W,_ as pe,u as he,a as me,r as u,B as y,G as D,c as l,d as e,e as P,k as d,q as b,w as R,g as f,v as S,t as o,F as E,l as A,f as j,m as K,p as Q,U as X,V as ge,h as q,b as ye,o as a,E as be,L as C,W as z}from"./index-B0cCL04z.js";import{a as _e}from"./order-DyDVzk1h.js";const fe="/assets/image-CApbiFEt.png",ke=async N=>{try{return await W("POST","/proxy/fetch",{url:N})}catch(x){throw x}},Pe=async N=>{try{return await W("POST","/proxy/search",{keyword:N})}catch(x){throw x}},Ce={class:"proxy-order-page container"},Ne={key:0,class:"input-section"},xe={class:"input-card"},Me=["disabled"],Te=["disabled"],Ve={key:0},Re=["disabled"],Se=["disabled"],Ie={key:0},Ue={key:1,class:"error-message"},Le={key:1,class:"product-display"},we={class:"product-images"},De={class:"main-image-wrapper"},Ee=["src"],Ke={class:"thumbnail-list"},qe=["src","alt","onClick"],Je={class:"product-info"},Ye={class:"product-name"},Fe={class:"product-specs"},He={class:"spec-item"},Oe={class:"spec-value price-jpy"},Be={class:"spec-item"},Ge={class:"spec-value"},Ae={class:"actions"},je={class:"quantity-selector"},Qe=["value"],Xe={class:"product-description"},ze={class:"pre-line-text"},$e={class:"price-summary"},We={class:"price-item"},Ze={class:"price-item"},et={class:"price-total"},tt={class:"action-buttons"},st={key:2,class:"search-results-container"},nt={class:"search-grid-header"},at={class:"product-grid"},lt=["onClick"],ot={key:0,class:"card-loading-overlay"},rt={class:"card-image-container"},it=["src","alt"],ut={key:0,class:"sold-out-badge"},ct={class:"card-content"},dt={class:"card-name"},vt={class:"card-price"},pt={class:"checkout-modal"},ht={class:"modal-body"},mt={key:1},gt={class:"summary"},yt={class:"form-group"},bt={class:"form-group"},_t={class:"form-group"},ft={class:"payment-options"},kt={class:"radio-label"},Pt={class:"radio-label"},Ct={key:0,class:"qr-code-container"},$=185,Nt=.05,xt={__name:"ProxyOrder",setup(N){const{t:x}=he(),Z=ye(),{showNotification:I}=me(),m=u(""),_=u(""),v=u(!1),p=u(!1),c=u(null),n=u(null),g=u([]),M=u(0),T=u(null),h=u(1),U=u(!1),L=u(!1),i=u({phone:"",address:"",paymentMethod:"cod"}),J=r=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(r),ee=y(()=>n.value&&n.value.imageURLs&&n.value.imageURLs.length>0?n.value.imageURLs[M.value]:""),te=y(()=>!n.value||!n.value.condition?"Không rõ":{"新品、未使用":"Mới, chưa sử dụng",未使用に近い:"Gần như mới",目立った傷や汚れなし:"Không có vết bẩn/trầy xước đáng kể",やや傷や汚れあり:"Có một chút vết bẩn/trầy xước",傷や汚れあり:"Có vết bẩn/trầy xước",全体的に状態が悪い:"Tình trạng chung không tốt","Không rõ":"Không rõ"}[n.value.condition]||n.value.condition),Y=y(()=>n.value?J(n.value.priceJPY):""),w=y(()=>n.value?n.value.priceJPY*$:0),F=y(()=>w.value*Nt),se=y(()=>w.value+F.value),ne=y(()=>se.value*h.value),H=y(()=>D(ne.value)),O=async()=>{var r,t;if(!m.value.includes("jp.mercari.com/item/")){c.value="URL không hợp lệ. Vui lòng dán link sản phẩm từ jp.mercari.com.";return}v.value=!0,c.value=null,n.value=null;try{const s=await ke(m.value);n.value=s,M.value=0}catch(s){console.error(s),c.value=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.error)||"Không thể lấy thông tin sản phẩm. Vui lòng thử lại sau."}finally{v.value=!1}},ae=async()=>{var r,t;if(!_.value){c.value="Vui lòng nhập từ khóa tìm kiếm.";return}p.value=!0,c.value=null,g.value=[];try{const s=await Pe(_.value);g.value=s||[],g.value.length===0&&(c.value="Không tìm thấy sản phẩm nào khớp với từ khóa.")}catch(s){console.error(s),c.value=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.error)||"Không thể tìm kiếm. Vui lòng thử lại sau."}finally{p.value=!1}},le=()=>{g.value=[],_.value="",c.value=null},B=()=>{n.value=null,m.value="",c.value=null,G()},oe=()=>{n.value=null,c.value=null,m.value="",G()},re=async r=>{if(!T.value){T.value=r.itemURL,m.value=r.itemURL;try{await O()}catch(t){console.error("Lỗi khi chọn sản phẩm:",t)}finally{T.value=null}}},ie=()=>h.value++,ue=()=>{h.value>1&&h.value--},ce=()=>{U.value=!0},V=()=>{U.value=!1},G=()=>{i.value={phone:"",address:"",paymentMethod:"cod"},h.value=1},de=()=>{q.value?ce():(I("Bạn cần đăng nhập để tiến hành đặt hàng.","error"),Z.push({path:"/login",query:{redirect:"/proxy-order"}}))},ve=async()=>{L.value=!0;const r={mercariURL:m.value,mercariItemID:n.value.mercariItemID,productName:n.value.name,productPriceJPY:n.value.priceJPY,productCondition:n.value.condition,productDescription:n.value.description,imageURLs:n.value.imageURLs,quantity:h.value,customerName:q.value.username,customerPhone:i.value.phone,customerAddress:i.value.address,customerEmail:q.value.email,paymentMethod:i.value.paymentMethod};try{await _e(r),I("Đặt hàng hộ thành công! Chúng tôi sẽ sớm liên hệ với bạn.","success"),V(),B()}catch(t){console.error("Failed to submit proxy order:",t),I(t.error||t,"error")}finally{L.value=!1}};return(r,t)=>(a(),l(E,null,[e("div",Ce,[!n.value&&g.value.length===0?(a(),l("div",Ne,[e("div",xe,[t[6]||(t[6]=e("h1",{class:"page-title"},"ĐẶT HÀNG TẠI MERCARI",-1)),t[7]||(t[7]=e("p",{class:"page-description"},[b(" Dán link sản phẩm từ "),e("strong",null,"jp.mercari.com"),b(" vào ô bên dưới. ")],-1)),e("form",{onSubmit:R(O,["prevent"]),class:"fetch-form"},[f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),type:"text",placeholder:"https://jp.mercari.com/item/m123456789...",class:"url-input",disabled:v.value||p.value},null,8,Me),[[S,m.value]]),e("button",{type:"submit",class:"btn-primary",disabled:v.value||p.value},[v.value?d("",!0):(a(),l("span",Ve,"Kiểm Tra Sản Phẩm")),v.value?(a(),P(C,{key:1,message:"Đang tải..."})):d("",!0)],8,Te)],32),t[8]||(t[8]=e("div",{class:"search-divider"},"--- HOẶC TÌM KIẾM SẢN PHẨM ---",-1)),e("form",{onSubmit:R(ae,["prevent"]),class:"search-form"},[f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),type:"text",placeholder:"Nhập tên sản phẩm (ví dụ: Gundam, Driver...)",class:"url-input",disabled:v.value||p.value},null,8,Re),[[S,_.value]]),e("button",{type:"submit",class:"btn-primary",disabled:v.value||p.value},[p.value?d("",!0):(a(),l("span",Ie,"Tìm Kiếm")),p.value?(a(),P(C,{key:1,message:"Đang tải..."})):d("",!0)],8,Se)],32),v.value||p.value?(a(),P(C,{key:0,message:"Đang tải dữ liệu từ Mercari, vui lòng chờ..."})):d("",!0),c.value?(a(),l("div",Ue,o(c.value),1)):d("",!0)])])):n.value?(a(),l("div",Le,[e("div",we,[e("div",De,[e("img",{src:ee.value,alt:"Product Image",class:"main-image"},null,8,Ee)]),e("div",Ke,[(a(!0),l(E,null,A(n.value.imageURLs,(s,k)=>(a(),l("img",{key:k,src:s,alt:"Thumbnail "+(k+1),class:be([{active:k===M.value},"thumbnail-item"]),onClick:Mt=>M.value=k},null,10,qe))),128))])]),e("div",Je,[e("h2",Ye,o(n.value.name),1),e("div",Fe,[e("div",He,[t[9]||(t[9]=e("span",{class:"spec-label"},"Giá gốc (JPY)",-1)),e("span",Oe,o(Y.value),1)]),e("div",Be,[t[10]||(t[10]=e("span",{class:"spec-label"},"Tình trạng",-1)),e("span",Ge,o(te.value),1)])]),e("div",Ae,[t[11]||(t[11]=e("span",{class:"quantity-label"},"Số lượng:",-1)),e("div",je,[e("button",{onClick:ue,"aria-label":"Giảm số lượng"},"-"),e("input",{type:"text",value:h.value,readonly:"","aria-label":"Số lượng hiện tại"},null,8,Qe),e("button",{onClick:ie,"aria-label":"Tăng số lượng"},"+")])]),e("div",Xe,[t[12]||(t[12]=e("strong",null,"Mô tả (tiếng Nhật):",-1)),e("p",ze,o(n.value.description),1),t[13]||(t[13]=e("em",{class:"translation-note"},"Lưu ý: Chức năng dịch mô tả sản phẩm sẽ sớm được cập nhật.",-1))]),e("div",$e,[t[16]||(t[16]=e("h3",null,"Báo Giá Dự Kiến (VNĐ)",-1)),e("div",We,[e("span",null,"Giá gốc ("+o(Y.value)+")",1),e("span",null,"~ "+o(j(D)(w.value)),1)]),e("div",{class:"price-item"},[t[14]||(t[14]=e("span",null,"Tỷ giá JPY-VND",-1)),e("span",null,"1 JPY = "+o($)+" VND")]),e("div",Ze,[t[15]||(t[15]=e("span",null,"Phí dịch vụ (5%)",-1)),e("span",null,o(j(D)(F.value)),1)]),t[17]||(t[17]=e("hr",{class:"divider"},null,-1)),e("div",et,[e("strong",null,"Tổng cộng (x"+o(h.value)+" sp)",1),e("strong",null,o(H.value),1)]),t[18]||(t[18]=e("p",{class:"note"},[b(" *Đây là giá dự kiến (chưa bao gồm phí vận chuyển nội địa Nhật nếu có). "),e("br"),b("*Phí vận chuyển về VN (195K/kg) sẽ được tính sau. ")],-1))]),e("div",tt,[e("button",{onClick:de,class:"btn-primary btn-order"}," Tiến Hành Đặt Hàng "),g.value.length>0?(a(),l("button",{key:0,onClick:oe,class:"btn btn-secondary"}," Quay lại kết quả ")):(a(),l("button",{key:1,onClick:B,class:"btn btn-secondary"}," Tìm sản phẩm khác "))])])])):g.value.length>0?(a(),l("div",st,[e("div",nt,[e("h2",null,'Kết quả tìm kiếm cho "'+o(_.value)+'"',1),e("button",{onClick:le,class:"btn btn-secondary"}," Quay lại ")]),e("div",at,[(a(!0),l(E,null,A(g.value,s=>(a(),l("div",{key:s.itemURL,class:"search-item-card",onClick:k=>re(s)},[T.value===s.itemURL?(a(),l("div",ot,[K(C)])):d("",!0),e("div",rt,[e("img",{src:s.imageURL,alt:s.name,class:"card-image"},null,8,it),s.isSoldOut?(a(),l("span",ut,"Đã Bán")):d("",!0)]),e("div",ct,[e("h3",dt,o(s.name),1),e("p",vt,o(J(s.priceJPY)),1)])],8,lt))),128))])])):d("",!0)]),(a(),P(ge,{to:"body"},[K(X,{name:"modal-fade"},{default:Q(()=>[U.value?(a(),l("div",{key:0,class:"modal-backdrop",onClick:R(V,["self"])},[e("div",pt,[e("div",{class:"modal-header"},[t[20]||(t[20]=e("h3",null,"Xác Nhận Đặt Hàng Hộ",-1)),e("button",{class:"close-btn",onClick:V},[...t[19]||(t[19]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",ht,[L.value?(a(),P(C,{key:0,message:"Đang xử lý đơn hàng..."})):(a(),l("div",mt,[e("div",gt,[e("p",null,[t[21]||(t[21]=b("Sản phẩm: ",-1)),e("strong",null,o(n.value.name),1)]),e("p",null,[t[22]||(t[22]=b("Số lượng: ",-1)),e("strong",null,o(h.value),1)]),e("p",null,[t[23]||(t[23]=b("Tổng tiền hàng (ước tính): ",-1)),e("strong",null,o(H.value),1)]),t[24]||(t[24]=e("p",{style:{"font-size":"0.9rem",opacity:"0.8","margin-top":"5px"}},"(Chưa bao gồm phí ship. Phí ship 195K/kg sẽ được thanh toán khi hàng về.)",-1))]),e("form",{onSubmit:R(ve,["prevent"])},[e("div",yt,[t[25]||(t[25]=e("label",{for:"phone"},"Số điện thoại",-1)),f(e("input",{id:"phone",type:"tel",class:"form-input","onUpdate:modelValue":t[2]||(t[2]=s=>i.value.phone=s),placeholder:"Nhập số điện thoại của bạn",required:""},null,512),[[S,i.value.phone]])]),e("div",bt,[t[26]||(t[26]=e("label",{for:"address"},"Địa chỉ nhận hàng",-1)),f(e("textarea",{id:"address",class:"form-input","onUpdate:modelValue":t[3]||(t[3]=s=>i.value.address=s),placeholder:"Nhập địa chỉ chi tiết của bạn",required:""},null,512),[[S,i.value.address]])]),e("div",_t,[t[30]||(t[30]=e("label",null,"Phương thức thanh toán",-1)),e("div",ft,[e("div",kt,[f(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=s=>i.value.paymentMethod=s),value:"cod"},null,512),[[z,i.value.paymentMethod]]),t[27]||(t[27]=e("span",null,"Thanh toán khi nhận hàng (COD)",-1))]),e("div",Pt,[f(e("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=s=>i.value.paymentMethod=s),value:"bank_transfer"},null,512),[[z,i.value.paymentMethod]]),t[28]||(t[28]=e("span",null,"Chuyển khoản ngân hàng",-1))]),K(X,{name:"fade"},{default:Q(()=>[i.value.paymentMethod==="bank_transfer"?(a(),l("div",Ct,[...t[29]||(t[29]=[e("img",{src:fe,alt:"Mã QR chuyển khoản",class:"qr-code-image"},null,-1),e("p",{class:"qr-code-note"}," Sau khi thanh toán xong hãy liên lạc với fanpage để xác nhận. ",-1)])])):d("",!0)]),_:1})])]),e("div",{class:"form-actions"},[e("button",{type:"button",class:"btn",onClick:V},"Hủy"),t[31]||(t[31]=e("button",{type:"submit",class:"btn-primary"},"Xác Nhận Đặt Hàng",-1))])],32)]))])])])):d("",!0)]),_:1})]))],64))}},Rt=pe(xt,[["__scopeId","data-v-ded46244"]]);export{Rt as default};
